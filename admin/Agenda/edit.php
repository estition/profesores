<?php include '../../includes/constants.php'?><?php include '../../includes/functions.php'?><?php include '../../includes/database.php'?><?php include '../../includes/authorize.php'?><?php include '../../includes/top.php'?><?php require_once 'google-api-php-client-master/autoload.php'?> <div style="position: relative;" align="center">   <?php?>      <h1>Updating Appointment</h1>      <?php    // load classes   $client_id = '895182433477-rn9l8l33eup83kompcaenjfafatdiago.apps.googleusercontent.com';$service_account_name = '895182433477-rn9l8l33eup83kompcaenjfafatdiago@developer.gserviceaccount.com';$key_file_location = 'certificates/cepayappoitment-d304559862fd.p12';	 // Calendar id$client = new Google_Client();$client->setApplicationName("cepayappoitment");$client->setClientId($client_id);//$service = new Google_Service_Calendar($client);$key = file_get_contents($key_file_location);$cred = new Google_Auth_AssertionCredentials( $service_account_name, array('https://www.googleapis.com/auth/calendar'), $key);	$client->setAssertionCredentials($cred);	$service = new Google_Service_Calendar($client);	    $calName = 'richardinglesadomicilio@gmail.com';           // get event details    if (!isset($_POST['submit'])) {      if (isset($_GET['id'])) {		  $eventId = $_GET['id'];		$event = $service->events->get($calName, $eventId);               } else {          die('ERROR: No event ID available!');        }        	  	function fmt_gdate( $gdate ) {	$time = array();	 $newdate =  new DateTime($gdate->getDateTime());     $time[0] = $newdate->format( 'Y-m-d' );	 $time[1] = $newdate->format( 'Y' );	 $time[2] = $newdate->format( 'm' );	 $time[3] = $newdate->format( 'd' );	 $time[4] = $newdate->format( 'G' );	 $time[5] = $newdate->format( 'i' );    return $time; }      // format data into human-readable form      // populate a Web form with the record	  $eventtid = $event->getId();      $title = $event->getSummary();            $datePicked_array =  fmt_gdate($event->getStart());	//  echo "<pre>";    // print_r($datePicked_array);	 //echo "<pre>";		  $content = $event->getDescription();	  //$handed = substr($content,42,12);	  //$Nohanded = substr($content,112,12);	  //$collected = substr($content,182,12);	      $sdate_dd = $datePicked_array[3];      $sdate_mm = $datePicked_array[2];      $sdate_yy = $datePicked_array[1];      $sdate_hh = $datePicked_array[4];      $sdate_ii = $datePicked_array[5];       $datePicked =   $datePicked_array[0];		  	  $myArray1 = explode(" ", $content);$handed = $myArray1[5]." ".$myArray1[6]." ".$myArray1[7];$Nohanded = $myArray1[15]." ".$myArray1[16]." ".$myArray1[17];$collected = $myArray1[24]." ".$myArray1[25]." ".$myArray1[26];//print_r($myArray1);	  	  	    ?>    <form method="post" action="<?php echo htmlentities($_SERVER['PHP_SELF']); ?>">      <input type="hidden" name="id" value="<?php echo $_GET['id']; ?>">      <input type="hidden" name="teacher_id" value="<?php echo $title; ?>">      <strong>Teacher ID:</strong>       <span><?php echo $title; ?></span><p/>     <table border="0" align="center" cellspacing="0" class="pepe1" bgcolor="#ccc" cellpadding="0">      <tr><td valign="top">      <div id="cont" align="left"></div><br />          <input style="text-align: center" readonly="true" name="info" id="info" size="33" value="<?php echo $datePicked; ?>" /></td></tr> <tr> <td>  <?php 	 if($is_admin_a){?>     <strong>Appointment Status:</strong>   <select name="appointmentState" type="text" size="1">   <option value="confirmed">confirmed</option>   <option value="cancelled">cancelled</option>   <option value="tentative">tentative</option>    </select>     <?php }?>        <input name="submit" type="submit" value="Save" /> </td></tr></table></div>      <?php  	include_once("datemoves.php");			$showdays=new datemoves;			$next_month1 = date('m');			$next_month2 = date('m') + 1;			if($next_month2 < 10)			$next_month2 = "0".$next_month2;			if(date('m') == 12){$next_month1 = "12";$next_month2 = "01"; $year2 = date('Y')+1;}else{$year2 = date('Y');}			$lista = $showdays->consultar(date('Y')."-".$next_month1."-01", $year2."-".$next_month2."-31");					//if ($email_exist>0|$username_exist>0) {				$equaldates = false;				$notequaldate = true;		if  ( $lista != false )  {							while($rowBlock = mysqli_fetch_array($lista)){					//print_r($rowBlock);			if($rowBlock["fechas1"] == $rowBlock["fechas2"]){			$blockdays[] = $rowBlock["fechas1"];	$comma_separatedblock = implode(",", $blockdays);	$dateblocked = str_replace("-", "", $comma_separatedblock);	$equaldates = true;}	else{		// echo $rowBlock["fechas1"]."rrrrrr";	if(date('Y')."-".date('m')."-".date('d') <= $rowBlock["fechas1"])	$date10 = str_replace("-", "", $rowBlock["fechas1"]);	else $date10 = date('Y').date('m').date('d');	$date20 = str_replace("-", "", $rowBlock["fechas2"]);	$notequaldate = false;}					//echo print_r($comma_separated1);	//echo $comma_separated1."sdasdas";			     }			 if(!$notequaldate){				 	//echo "vvvvvv";    print "<input name='date10' type='hidden' id='date10' value= '".  $date10."'>";	print "<input name='date20' type='hidden' id='date20' value='" . $date20. "'>";	print "<input name='date30' type='hidden' id='date30' value='" . $dateblocked. "'>";			 }elseif($equaldates && $notequaldate){ $lista = 0; 		print "<input name='date10' type='hidden' id='date10' value='" . date('Y').date('m').date('d'). "'>";	print "<input name='date20' type='hidden' id='date20' value='" . date('Y').date('m')."15'>";	print "<input name='date30' type='hidden' id='date30' value='" . $dateblocked. "'>";			 }		}else{			print "<input name='date10' type='hidden' id='date10' value='" . date('Y').date('m').date('d'). "'>";	print "<input name='date20' type='hidden' id='date20' value='" . date('Y').date('m')."15'>";	print "<input name='date30' type='hidden' id='date30' value='" . $dateblocked. "'>";}?>     <script type="text/javascript" src="calendar/JSCal2-1.9/src/js/jscal2.js"></script><script type="text/javascript" src="calendar/JSCal2-1.9/src/js/lang/en.js"></script><link rel="stylesheet" type="text/css" media="all" href="calendar/JSCal2-1.9/src/css/jscal2.css"  /><link rel="stylesheet" type="text/css" href="calendar/JSCal2-1.9/src/css/border-radius.css" /><link rel="stylesheet" type="text/css" href="calendar/JSCal2-1.9/src/css/steel/steel.css" />                                       <br/>      <?php    $sql = " SELECT * FROM entry_endtime ORDER BY id DESC LIMIT 1";	$result = mysqli_query($link, $sql) or die("Invalid query: " . mysqli_error($link));	$name_exist = mysql_num_rows($result);	if ($row = mysqli_fetch_array($result, MYSQLI_ASSOC)){ 	if($name_exist == 0){		$endtime = 13;}	else{			$endtime =  $row["endtime"];}		 }else{$endtime =13;}	   for($i=10; $i<=$endtime; $i++){		   $endtime1 .= "<option value='" . $i .  "'>" . $i . "</option>";	   }		?>     <strong>Time: </strong>           <select name="sdate_hh" type="text" size="1" id="sdate_hh">	 <option value="<?php echo $sdate_hh; ?>"><?php echo $sdate_hh; ?></option>	 <?php echo  $endtime1; ?></select> <strong>:</strong> <!-- drop down #2, list contents depend on value selected in drop-down #1 -->    <!-- code in the file js/AjaxCode.js will populate this drop-down list                  -->  <select name="sdate_ii" id="sdate_ii" type="text" size="1">  <option value="<?php echo $sdate_ii; ?>"><?php echo $sdate_ii; ?></option>  <option value="00">00</option>  <option value="15">15</option>  <option value="30">30</option>  <option value="45">45</option>  </select>     <br/>    <br/>        <strong><font COLOR=RED>Client payments handed in:</font></strong>        <br/>  <select name="Stienes" type="text" size="1"> <option value="<?php echo  $handed ; ?>"><?php echo  $handed; ?></option> <option value="">-----------</option>        <option value="0 Client payments">0 Client payments </option>          <option value="1 Client payment">1 Client payment </option>          <option value="2 Client payments">2 Client payments</option>          <option value="3 Client payments">3 Client payments</option>          <option value="4 Client payments">4 Client payments</option>          <option value="5 Client payments">5 Client payments</option>          <option value="6 Client payments">6 Client payments</option>          <option value="7 Client payments">7 Client payments</option>          <option value="8 Client payments">8 Client payments</option>          <option value="9 Client payments">9 Client payments</option>   </select>   <br/>   <br/>  <strong><font COLOR=RED>Client payments not handed in:</font></strong>  <br/><font COLOR=GREEN>(In your posession)</font><br/>  <select name="SnoTienes" type="text" size="1">   <option value="<?php echo  $Nohanded ; ?>"><?php echo  $Nohanded; ?></option>  <option value="">-----------</option>      <option value="0 Client payments">0 Client payments </option>          <option value="1 Client payment">1 Client payment </option>          <option value="2 Client payments">2 Client payments</option>          <option value="3 Client payments">3 Client payments</option>          <option value="4 Client payments">4 Client payments</option>          <option value="5 Client payments">5 Client payments</option>          <option value="6 Client payments">6 Client payments</option>          <option value="7 Client payments">7 Client payments</option>          <option value="8 Client payments">8 Client payments</option>          <option value="9 Client payments">9 Client payments</option>    </select>  <br/>   <br/>  <strong><font COLOR=RED>Client payments not collected yet:</font></strong><br/> <select name="SnoCollected" type="text" size="1"> <option value="<?php echo  $collected ; ?>"><?php echo  $collected; ?></option><option value="">-----------</option>        <option value="0 Client payments">0 Client payments </option>          <option value="1 Client payment">1 Client payment </option>          <option value="2 Client payments">2 Client payments</option>          <option value="3 Client payments">3 Client payments</option>          <option value="4 Client payments">4 Client payments</option>          <option value="5 Client payments">5 Client payments</option>          <option value="6 Client payments">6 Client payments</option>          <option value="7 Client payments">7 Client payments</option>          <option value="8 Client payments">8 Client payments</option>          <option value="9 Client payments">9 Client payments</option>   </select>      </form>          <?php                        } else {      // if form submitted      // validate input      if (empty($_POST['id'])) {        die('ERROR: Missing event ID');      } else{		 // echo $_POST['id']."WWWWWWWWW";      $event = $service->events->get($calName, $_POST['id']); }     /*	  echo $_POST["info"]."TIMEEEEEEE";	   	   $yy = intval(substr($_POST["info"],0,4));	   	 	$mm = intval(substr($_POST["info"],5,2));		$dd = intval(substr($_POST["info"],8,2));			*/				$minutePlus = $_POST['sdate_ii']+5;			//$start1 =  $_REQUEST["date1"];		//$start2 = date(DATE_ATOM, mktime($start1));			     // $start = date(DATE_ATOM, mktime($_POST['sdate_hh'], $_POST['sdate_ii'], 0, $mm, $dd, $yy ));     // $end = date(DATE_ATOM, mktime($_POST['sdate_hh'], $minutePlus, 0, $mm, $dd, $yy ));	 // echo $start."GGGGGGGGGGGGGGGGGG";	     $startcomp = $_POST["info"]."T".$_POST['sdate_hh'].":".$_POST['sdate_ii'].":00+01:00";	   $endcomp = $_POST["info"]."T".$_POST['sdate_hh'].":".$minutePlus.":00+01:00";	 // echo $startcomp."HHHHHHHHHH";	$Stienes   = htmlentities($_POST['Stienes']);	$SnoTienes = htmlentities($_POST['SnoTienes']);	$Stotal = htmlentities($_POST['SnoCollected']);		$Ctotal = $Stienes + $SnoTienes + $Stotal;	 $desc = "--> Handed in: <strong><font COLOR=GREEN> ".$Stienes." </font> | </strong>Not handed in: <strong><font COLOR=RED> ".$SnoTienes." </font> | </strong>Collected : <strong><font COLOR=GREEN> ".$Stotal." </font> | </strong>Total: <strong><font COLOR=GREEN> ".$Ctotal." envelopes</font></strong>";  		//$desc = "--> Total: <strong><font COLOR=GREEN>". $Stotal."</font></strong>, Ready:<strong><font COLOR=GREEN> ".$Stienes." </font></strong>and Pending: <strong><font COLOR=RED>".$SnoTienes."</font></strong>"; 	      // get existing event record      // update event attributes      // save changes to server	  	  	include_once("consult.php");	  $consultar_eventos_fecha=new consult;				  			$user_name = $id_arti."-".$first;	         $eventFeed2=$consultar_eventos_fecha->ver_reg_fecha($startcomp, $endcomp, $service);		//print_r($event);    	$total_fecha = sizeof($eventFeed2); 			//echo $total_fecha."dddd"; 	switch ($total_fecha) {    case "0":	         	 if($is_admin_a){  		$state = htmlentities($_POST['appointmentState']);            $event->setLocation($state);  }   $event->setDescription($desc);  $start1 = new Google_Service_Calendar_EventDateTime();  $start1->setDateTime($startcomp);    $event->setStart($start1);     $end1 = new Google_Service_Calendar_EventDateTime();    $end1->setDateTime($startcomp);  $event->setEnd($end1);  	$updatedEvent = $service->events->update('richardinglesadomicilio@gmail.com', $_POST['id'], $event); // Print the updated date.echo $updatedEvent->getUpdated();            echo '<h3>Appointment successfully modified!</h3>'; 	   break;    case "1"://echo $eventFeed2[0]->getSummary()."YYYYYY";//echo $event->getSummary()."UUUUUU";	if($eventFeed2[0]->getSummary() == $event->getSummary()){		if($is_admin_a){  		$state = htmlentities($_POST['appointmentState']);         $event->setLocation($state);  }  $event->setDescription($desc);  $start1 = new Google_Service_Calendar_EventDateTime();  $start1->setDateTime($startcomp);                         $event->setStart($start1);       $end1 = new Google_Service_Calendar_EventDateTime();  $end1->setDateTime($startcomp);  $event->setEnd($end1);$updatedEvent = $service->events->update('richardinglesadomicilio@gmail.com', $_POST['id'], $event); // Print the updated date.echo $updatedEvent->getUpdated();    echo '<h3>Appointment successfully modifieddd!</h3>'; 		}else{        echo "<h3>Appointment occupied by another user, Please choose a free one from the appointment list</h3>";}        break;		} 	 }	        ?><script type="text/javascript">//<![CDATA[       function updateFields(cal) {              var date = cal.selection.get();              if (date) {                      date = Calendar.intToDate(date);                      document.getElementById("info").value = Calendar.printDate(date, "%Y-%m-%d");              }                   };	  	 //alert(document.getElementById("date10").value.split(',').length);	 	date10 = document.getElementById("date10").value.split(',');	   	date20 = document.getElementById("date20").value.split(',');//document.write(date10[0]);//document.write(date20[0]);//document.write(date30[0]); obj = new Object;var temp = 0;   var pepe=new Array();  date30 = document.getElementById("date30").value.split(',');  for (counter=0; counter<date30.length; counter++){  		temp = Number(date30[counter]);	//alert(temp);	pepe[temp] = true;	  }        Calendar.setup({              cont          : "cont",              fdow          : 1,			  min			:  Number(date10[0]),              max			:  Number(date20[0]),			  selectionType : Calendar.SEL_SINGLE,			 /* disabled      : function(date) {				//alert(document.getElementById("date10").value);				alert(date.format("m/dd/yy"));				   date = Calendar.dateToInt(date);				   return (date <= document.getElementById("date10").value && date >= document.getElementById("date20").value);				 },*/						 disabled: function(date) {								 if ((date.getDay() == 0) || (date.getDay() == 6) ) {            return true;        } else {					 date = Calendar.dateToInt(date);             return date in pepe;			                     }},			  onSelect      : updateFields			        });    //]]></script>    