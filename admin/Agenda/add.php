<head>	 <script src="../../../SpryAssets/SpryValidationSelect.js" type="text/javascript"></script><script src="../../../SpryAssets/SpryValidationTextField.js" type="text/javascript"></script><style type="text/css">body { font-size: 11px; font-family: "verdana"; }pre { font-family: "verdana"; font-size: 10px; background-color: #FFFFCC; padding: 5px 5px 5px 5px; }pre .comment { color: #008000; }pre .builtin { color:#FF0000;  }</style><link href="../../../SpryAssets/SpryValidationSelect.css" rel="stylesheet" type="text/css" /><link href="../../../SpryAssets/SpryValidationTextField.css" rel="stylesheet" type="text/css" /><style type="text/css"><!--.style1 {	color: #FFFFFF;	font-weight: bold;}.style2 {font-size: 18pt}--></style></head><?php include 'includes/constants.php'?><?php include 'includes/functions.php'?><?php include 'includes/database.php'?><?php include 'includes/authorize.php'?><?php include '../../includes/top.php'?><?php require_once 'google-api-php-client-master/autoload.php'?> <div style="position: relative;" align="center">      <h1>Add Appointment</h1>  <?php  	include("authorize_user.php");$authorize_eventos=new authorize_user;        $teachers=$authorize_eventos->authorizeUser();?>              <?php if (!isset($_POST['submit'])) { ?>        <form method="post" action="<?php echo htmlentities($_SERVER['PHP_SELF']); ?>">      <p/>   <table border="0" align="center" cellspacing="0" class="pepe1" bgcolor="#ccc" cellpadding="0">  <tr>    <td width="200" rowspan="5" valign="top"><div id="cont"></div>          <input style="text-align: center" readonly="true" name="info" id="info" size="33" />       </td>      <td>                <?php  if($is_admin_a){ ?>                 <strong>Teacher's name: </strong> <br/>    <select name="teacher_id" ><?php echo  $teachers; ?></select>    <?php } ?> <br />  <?php    $sql = " SELECT * FROM entry_endtime ORDER BY id DESC LIMIT 1";	$result = mysqli_query($link, $sql) or die("Invalid query: " . mysqli_error($link));	$name_exist = mysql_num_rows($result);	if ($row = mysqli_fetch_array($result, MYSQLI_ASSOC)){ 	if($name_exist == 0){		$endtime = 13;}	else{			$endtime =  $row["endtime"];}		 }else{$endtime =13;}	   for($i=10; $i<=$endtime; $i++){		   $endtime1 .= "<option value='" . $i .  "'>" . $i . "</option>";	   }		?>     <strong>Time: </strong>           <select name="sdate_hh" type="text" size="1" id="sdate_hh"><?php echo  $endtime1; ?></select>     <!-- <option value="14">14</option>-->   <strong>:</strong>  <!-- drop down #2, list contents depend on value selected in drop-down #1 -->    <!-- code in the file js/AjaxCode.js will populate this drop-down list                  -->  <select name="sdate_ii" id="sdate_ii" type="text" size="1">  <option value="00">00</option>  <option value="15">15</option>  <option value="30">30</option>  <option value="45">45</option>  </select>      <br/>    <br/>        <strong><font COLOR=RED>Client payments handed in:</font></strong>        <br/>        <span id="spryselect0">        <select name="Stienes" type="text" size="1">          <option value="">-----------</option>          <option value="0 Client payments">0 Client payments </option>          <option value="1 Client payment">1 Client payment </option>          <option value="2 Client payments">2 Client payments</option>          <option value="3 Client payments">3 Client payments</option>          <option value="4 Client payments">4 Client payments</option>          <option value="5 Client payments">5 Client payments</option>          <option value="6 Client payments">6 Client payments</option>          <option value="7 Client payments">7 Client payments</option>          <option value="8 Client payments">8 Client payments</option>          <option value="9 Client payments">9 Client payments</option>        </select>        <span class="selectRequiredMsg">Please select an item.</span></span><br/>   <br/>  <strong><font COLOR=RED>Client payments not handed in:</font></strong>  <br/><font COLOR=GREEN>(In your posession)</font><br/>  <span id="spryselect1">  <select name="SnoTienes" type="text" size="1">    <option value="">-----------</option>          <option value="0 Client payments">0 Client payments </option>          <option value="1 Client payment">1 Client payment </option>          <option value="2 Client payments">2 Client payments</option>          <option value="3 Client payments">3 Client payments</option>          <option value="4 Client payments">4 Client payments</option>          <option value="5 Client payments">5 Client payments</option>          <option value="6 Client payments">6 Client payments</option>          <option value="7 Client payments">7 Client payments</option>          <option value="8 Client payments">8 Client payments</option>          <option value="9 Client payments">9 Client payments</option>  </select>  <span class="selectRequiredMsg">Please select an item.</span></span><br/>   <br/>  <strong><font COLOR=RED>Client payments not collected yet:</font></strong><br/>  <span id="spryselect2">  <select name="Stotal" type="text" size="1">    <option value="">-----------</option>           <option value="0 Client payments">0 Client payments </option>          <option value="1 Client payment">1 Client payment </option>          <option value="2 Client payments">2 Client payments</option>          <option value="3 Client payments">3 Client payments</option>          <option value="4 Client payments">4 Client payments</option>          <option value="5 Client payments">5 Client payments</option>          <option value="6 Client payments">6 Client payments</option>          <option value="7 Client payments">7 Client payments</option>          <option value="8 Client payments">8 Client payments</option>          <option value="9 Client payments">9 Client payments</option>  </select>  <span class="selectRequiredMsg">Please select an item.</span></span><br />  </td>   </tr>  <tr> <td>  <?php 	 if($is_admin_a){?>     <strong>Appointment Status:</strong>   <select name="appointmentState" type="text" size="1">   <option value="confirmed">confirmed</option>   <option value="cancelled">cancelled</option>   <option value="tentative">tentative</option>    </select>     <?php }?>        <input name="submit" type="submit" value="Save" /> </td></tr></table></div> <?php  	include_once("datemoves.php");			$showdays=new datemoves;			$next_month1 = date('m') - 1;			$next_month2 = date('m') + 1;			$year2 = date('Y');			if($next_month2 < 10)			$next_month2 = "0".$next_month2;			if(date('m') == 12){$next_month1 = "12";$next_month2 = "01"; $year2 = date('Y')+1;}			$lista = $showdays->consultar(date('Y')."-".$next_month1."-01", $year2."-".$next_month2."-31");					//if ($email_exist>0|$username_exist>0) {				$equaldates = false;				$notequaldate = true;		if  ( $lista == true )  {									while($rowBlock = mysqli_fetch_array($lista)){								if($rowBlock["fechas1"] == $rowBlock["fechas2"]){			$blockdays[] = $rowBlock["fechas1"];	$comma_separatedblock = implode(",", $blockdays);	$dateblocked = str_replace("-", "", $comma_separatedblock);	$equaldates = true;}	else{		 //echo $rowBlock["fechas1"]."rrrrrr";	if(date('Y')."-".date('m')."-".date('d') <= $rowBlock["fechas1"])	$date10 = str_replace("-", "", $rowBlock["fechas1"]);	else $date10 = date('Y').date('m').date('d');	$date20 = str_replace("-", "", $rowBlock["fechas2"]);	$notequaldate = false;	}			//echo print_r($comma_separated1);	//echo $comma_separated1."sdasdas";			     }			 			 if(!$notequaldate){				    print "<input name='date10' type='hidden' id='date10' value= '".  $date10."'>";	print "<input name='date20' type='hidden' id='date20' value='" . $date20. "'>";	print "<input name='date30' type='hidden' id='date30' value='" . $dateblocked. "'>";			 }elseif($equaldates && $notequaldate){ $lista = 0; 							 if(date('d') == 25 || date('d') == 26 || date('d') == 27 || date('d') == 28 || date('d') == 29 || date('d') == 30 ||  date('d') == 31  || date('d') == 01 || date('d') == 02 || date('d') == 03 || date('d') == 04 || date('d') == 05){	$nextmonth = $next_month2; 	$nextday = "05";}else{$nextmonth = date('m'); $nextday = date('d');} 	print "<input name='date10' type='hidden' id='date10' value='" .  date('Y').$nextmonth.$nextday. "'>";	print "<input name='date20' type='hidden' id='date20' value='" . date('Y').$nextmonth."15'>";	print "<input name='date30' type='hidden' id='date30' value='" . $dateblocked. "'>";			 }		}else{							if(date('d') == 25 || date('d') == 26 || date('d') == 27 || date('d') == 28 || date('d') == 29 || date('d') == 30 ||  date('d') == 31  || date('d') == 01 || date('d') == 02 || date('d') == 03 || date('d') == 04 || date('d') == 05){	$nextmonth = $next_month2; 	$nextday = "05";}else{$nextmonth = date('m'); $nextday = date('d');} 	print "<input name='date10' type='hidden' id='date10' value='" . date('Y').date('m').$nextday. "'>";	print "<input name='date20' type='hidden' id='date20' value='" . date('Y').date('m')."15'>";	print "<input name='date30' type='hidden' id='date30' value='" . $dateblocked. "'>";}?>     <script type="text/javascript" src="calendar/JSCal2-1.9/src/js/jscal2.js"></script><script type="text/javascript" src="calendar/JSCal2-1.9/src/js/lang/en.js"></script><link rel="stylesheet" type="text/css" media="all" href="calendar/JSCal2-1.9/src/css/jscal2.css"  /><link rel="stylesheet" type="text/css" href="calendar/JSCal2-1.9/src/css/border-radius.css" /><link rel="stylesheet" type="text/css" href="calendar/JSCal2-1.9/src/css/steel/steel.css" />              <p><table class="pepe1" border="0" align="center"> <tr><td align="center"><h1><font COLOR=BLUE>Pay Appointment Information</font></h1></td>  </tr>  <tr>    <td bordercolor="#000000">      <p><strong><font COLOR=BLUE>-	The start date that the system allows you to make an appointment is from the 25th (at 00:00 h) for the pay period that begins on the 1st (or 2nd or 3rd if the 1st is a Sat or Sun) and ends on the 5th of every month. <br /><br />       - Please be on time for your appointment. If you arrive more than 10 minutes late, your appointment will be cancelled and you'll have to sign up for the next available appointment. <br /><br />      - If you do not sign up for a pay appointment during the official pay period, or you miss your appointment, then you would have to wait until the next pay period during the following month. In this case, you would still need to come in to pick up your bills to take to your clients for the new month in progress. <br /><br />     - All client payments need to be handed in by the 20th. If you turn in your client payments on the day of your pay appointment, your pay appointment will be cancelled and you will have to sign up for a new appointment on another day.  <br /><br />      - Your teaching hours need to be inputted by the 25th. You also have to input the hours that you will be teaching after the 25th, and then, very important (to avoid confusion and delays during your pay appointment), go back to change them if there are unexpected cancellations after the 25th.<br /><br />- All student reports must be completed before you can get paid (This applies ONLY to the June and December pay periods or before your last pay appointment for a class that has ended). If the student report is not done correctly you will have to sign up for another pay appointment. <br /><br />- The office hours are from 10:00 to 18:00 h Monday through Thursday and from 10:00 to 15:00 h on Friday. The office is NOT open on weekends!</font></strong></p>      <p>&nbsp;</p></td>  </tr></table> </p>         </form>      <?php    } else {						   $client_id = '895182433477-rn9l8l33eup83kompcaenjfafatdiago.apps.googleusercontent.com';$service_account_name = '895182433477-rn9l8l33eup83kompcaenjfafatdiago@developer.gserviceaccount.com';$key_file_location = 'certificates/cepayappoitment-d304559862fd.p12';	 // Calendar id$client = new Google_Client();$client->setApplicationName("cepayappoitment");$client->setClientId($client_id);//$service = new Google_Service_Calendar($client);$key = file_get_contents($key_file_location);$cred = new Google_Auth_AssertionCredentials( $service_account_name, array('https://www.googleapis.com/auth/calendar'), $key);	$client->setAssertionCredentials($cred);	$service = new Google_Service_Calendar($client);	 $calName = 'richardinglesadomicilio@gmail.com'; 	    $minutePlus = $_POST['sdate_ii']+5;			//$start1 =  $_REQUEST["date1"];		//$start2 = date(DATE_ATOM, mktime($start1));			     // $start = date(DATE_ATOM, mktime($_POST['sdate_hh'], $_POST['sdate_ii'], 0, $mm, $dd, $yy ));     // $end = date(DATE_ATOM, mktime($_POST['sdate_hh'], $minutePlus, 0, $mm, $dd, $yy ));	 // echo $start."GGGGGGGGGGGGGGGGGG";	     $startcomp = $_POST["info"]."T".$_POST['sdate_hh'].":".$_POST['sdate_ii'];	   $endcomp = $_POST["info"]."T".$_POST['sdate_hh'].":".$minutePlus;	 // echo $startcomp."HHHHHHHHHH";	$Stienes   = htmlentities($_POST['Stienes']);	$SnoTienes = htmlentities($_POST['SnoTienes']);	$Stotal = htmlentities($_POST['SnoCollected']);		$Ctotal = $Stienes + $SnoTienes + $Stotal;	 $desc = "--> Handed in: <strong><font COLOR=GREEN> ".$Stienes." </font> | </strong>Not handed in: <strong><font COLOR=RED> ".$SnoTienes." </font> | </strong>Collected : <strong><font COLOR=GREEN> ".$Stotal." </font> | </strong>Total: <strong><font COLOR=GREEN> ".$Ctotal." envelopes</font></strong>";  		//$desc = "--> Total: <strong><font COLOR=GREEN>". $Stotal."</font></strong>, Ready:<strong><font COLOR=GREEN> ".$Stienes." </font></strong>and Pending: <strong><font COLOR=RED>".$SnoTienes."</font></strong>"; 	      // get existing event record      // update event attributes      // save changes to server	  //echo $first."PPPPP";	  	include_once("consult.php");	  $consultar_eventos_fecha=new consult;				  			$user_name = $id_arti."-".$first;	  //echo $startcomp."HHHHHHHHHH";	  // echo $endcomp."HHHHHHHHHH";        $eventFeed2=$consultar_eventos_fecha->ver_reg_fecha($startcomp, $endcomp, $service);		//print_r($event);    	$total_fecha = sizeof($eventFeed2); 			switch ($total_fecha) {    case "0":		    if(isset($_POST['teacher_id'])) {		$seek = $_POST['teacher_id'];      }else{$seek = $user_name; }	        $getuser=$consultar_eventos_fecha->ver_reg_fecha_user(date('Y')."-".date('m')."-01", date('Y')."-".date('m')."-31", $seek, $service);		//	echo "<pre>";	//	print_r($getuser);	//	echo "<pre>";    	$total_user = sizeof($getuser); 		if($total_user == 0){$event = new Google_Service_Calendar_Event();$event->setSummary($seek);//$event->setLocation("test location");$start = new Google_Service_Calendar_EventDateTime();$datetimeclass1 = new DateTime($startcomp);//$datetimeclass2 = new DateTime($startcomp);$pepe1 = $datetimeclass1->format(DateTime::RFC3339);//$pepe2 = $datetimeclass2->format(DateTime::RFC3339);$start->setDateTime($pepe1);$event->setStart($start);$end = new Google_Service_Calendar_EventDateTime();$end->setDateTime($pepe1);$event->setEnd($end);//$attendee1 = new EventAttendee();//$attendee1->setEmail('email@email.com');//$attendees = array($attendee1);//$event->attendees = $attendees;			     if($is_admin_a){  		$state = htmlentities($_POST['appointmentState']);            $event->setLocation($state);   }   $event->setDescription($desc); $createdEvent = $service->events->insert('richardinglesadomicilio@gmail.com', $event);            echo '<h1><strong><font size= 14 COLOR=GREEN>appointment successfully added!</font></strong></h1></br></br>'; 	echo '<h2><strong><font size= 18 COLOR=RED>(Applicable only for Nobember-December-April-May )all student reports must be completed before you can get paid. To access the reports, go to the Student Reports menu option!</font></strong></h2>';   echo " <img src=../../../imagenes/right.png alt=good_choice style=float:center/>";		}		else{      echo "<h3><strong><font size= 18 COLOR=RED>You have an appointment for this month, if you whish to modify your appointment date, go to the appointment list and click on edit link</font></strong></h3> ";		  echo " <img src=../../../imagenes/redcross.jpg alt=bad_choice style=float:center/>";		}	   break;    case "1":echo "<h3><strong><font size= 18 COLOR=RED>Appointment occupied by another user, Please choose a free one from the appointment list</font></strong></h3>";   echo " <img src=../../../imagenes/redcross.jpg alt=bad_choice style=float:center/>";        break;		} 	       }      ?>   <?php  include 'includes/foot.php'?> <script type="text/javascript">//<![CDATA[       function updateFields(cal) {              var date = cal.selection.get();              if (date) {                      date = Calendar.intToDate(date);                      document.getElementById("info").value = Calendar.printDate(date, "%Y-%m-%d");              }                   };	  	// alert(document.getElementById("date10").value.split(','));	//  alert(document.getElementById("date20").value.split(','));	 	date10 = document.getElementById("date10").value.split(',');	   	date20 = document.getElementById("date20").value.split(','); obj = new Object;var temp = 0;   var pepe=new Array();  date30 = document.getElementById("date30").value.split(',');  for (counter=0; counter<date30.length; counter++){  		temp = Number(date30[counter]);	pepe[temp] = true;	  }        Calendar.setup({              cont          : "cont",              fdow          : 1,			  min			:  Number(date10[0]),              max			:  Number(date20[0]),			  selectionType : Calendar.SEL_SINGLE,			 /* disabled      : function(date) {				//alert(document.getElementById("date10").value);				alert(date.format("m/dd/yy"));				   date = Calendar.dateToInt(date);				   return (date <= document.getElementById("date10").value && date >= document.getElementById("date20").value);				 },*/						 disabled: function(date) {								 if ((date.getDay() == 0) || (date.getDay() == 6) ) {            return true;        } else {					 date = Calendar.dateToInt(date);             return date in pepe;			                     }},			  onSelect      : updateFields			        });    //]]></script>    <script type="text/javascript"><!--var spryselect0 = new Spry.Widget.ValidationSelect("spryselect0");var spryselect1 = new Spry.Widget.ValidationSelect("spryselect1");var spryselect2 = new Spry.Widget.ValidationSelect("spryselect2");</script>